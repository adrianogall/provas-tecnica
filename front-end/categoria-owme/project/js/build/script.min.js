
/*###########################################
    SCRIPT - Prova Técnica | Adriano Gall
###########################################*/


//Busca os parâmetros da url para executar alistagem de produtos
const getParameterUrl = () => {
    
    let query = location.search.slice(1),
        partes = query.split('&'),
        data = {};

    partes.forEach(parte => {
        if(parte != ''){
            let chaveValor = parte.split('=') 
                chave = chaveValor[0],
                valor = chaveValor[1];
            data[chave] = valor;
        }            
    });
    return data;
}

//Variáveis iniciais
let numPage = 1,
    qntPage = 20,
    Xmlhttp = new XMLHttpRequest(),
    arqJsonProd = "../../project/files/mock-products.json",
    getParamUrl = getParameterUrl(),
    filter = "valor-desc",
    urlInitial = true;
    
//Verifica de tem parâmetros de filtros passados na url no carregamento da página
if(getParamUrl.hasOwnProperty('q')){  

    urlInitial = false;
    filter = getParamUrl.q;
    window.document.getElementById("change-filter").value = filter;
    
    if(getParamUrl.hasOwnProperty('page'))
        numPage = getParamUrl.page;
} 

//Função start para as funcinalidades de filtro e paginação
const getStartListProd = (filter, numPage) => {

    document.getElementById("bg-loader").style.display = "block";
    setTimeout(function(){ 
        objJsonProd = localStorage.getItem('objJsonProd');
    objJsonProd = JSON.parse(objJsonProd).products;
    orderFilterJson(objJsonProd, filter, numPage);
    setUrlFilter(filter, numPage);    
    document.getElementById("bg-loader").style.display = "none"; 
    }, 1000);
    
}

const request = obj => {
    return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();
        xhr.open(obj.method || "GET", obj.url);
        if (obj.headers) {
            Object.keys(obj.headers).forEach(key => {
                xhr.setRequestHeader(key, obj.headers[key]);
            });
        }
        xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(xhr.response);
            } else {
                reject(xhr.statusText);
            }
        };
        xhr.onerror = () => reject(xhr.statusText);
        xhr.send(obj.body);
    });
};


request({url: arqJsonProd, method: 'GET'})
    .then(data => {
        localStorage.setItem("objJsonProd", data);
        getStartListProd(filter, numPage);  
    })
    .catch(error => {
        console.log(error);
});
 
//Atualiza os parâmetros na url
const setUrlFilter = (filter, numPage) => 
    window.history.replaceState('', '', window.location.href.split('?')[0] + "?q=" + filter + "&page=" + numPage);

//Contrutor da listagem de produtos
const constListProducts = (arrProd, numPage) => {

    var htmlListProd = "",
        targetProd = parseInt(numPage-1) * parseInt(qntPage),
        i2 = 0;

    for(var i = 0; i < arrProd.length; i++) {
        if(targetProd <= i && i2 < qntPage){
            htmlListProd += `<li>
                                <div class="cont">
                                    <a class="link" href="javascript:void(0)" title="` + arrProd[i].name + `" class="` + arrProd[i].name+`"></a>
                                    <div class="thumb"><img alt="` + arrProd[i].name + `" title="` + arrProd[i].name + `" src="` + arrProd[i].image + `"></div>
                                    <div class="desc">
                                        <h3>` + arrProd[i].name + `</h3>
                                        <p> <span>R$ ` + numberToReal(arrProd[i].price); + `</span></p>
                                    </div>
                                </div>
                            </li>`;
            i2++;
        }                       
    }
    document.getElementById("list-products").innerHTML = htmlListProd;
}

//Contrutor da paginação
const constPaginator = (objList, filter, numPage) => {

    let qntTotal = Object.keys(objList).length,
        htmlListPag = "",
        contrPag = parseInt(qntTotal-1) / parseInt(qntPage);
        
    for(let i = 1; i <= Math.ceil(contrPag); i++) {
        if(numPage == i)
            htmlListPag += `<li class="active"><span>` + i + `</span></li>`;
        else
            htmlListPag += `<li><a href="javascript:void(0)" onClick="getStartListProd('` + filter + `',` + i + `);">` + i + `</a></li>`;             
    }
    document.getElementById("pag-prod-nav").innerHTML = htmlListPag;
}

//Ordena o abjeto de produtos de acordo com o filtro
const orderFilterJson = (objList, filter, numPage) => { 

    let arrFilter = filter.split('-');
    objList.sort(dynamicSort(arrFilter));   
    let arrProd = Object.values(objList);
    
    //Construtor da listagem de produtos
    constListProducts(arrProd, numPage);
    
    //Construtor da paginação
    constPaginator(objList, filter, numPage);
    
    window.scrollTo(0, 50);
}

//Ordena o object de produtos conforme os parâmetros passados
const dynamicSort = arrtFilter => {

    let sortOrder = 1,
        result;

    if(arrtFilter[0] === "-") {
        sortOrder = -1;
        arrtFilter = arrtFilter.substr(1);
    }

    return (a,b) => {
        if(arrtFilter[1] == 'asc')
            result = (a[arrtFilter[0]] < b[arrtFilter[0]]) ? -1 : (a[arrtFilter[0]] > b[arrtFilter[0]]) ? 1 : 0;
        else
            result = (a[arrtFilter[0]] > b[arrtFilter[0]]) ? -1 : (a[arrtFilter[0]] < b[arrtFilter[0]]) ? 1 : 0;
        return result * sortOrder;
    }
}

//Trata o valor inteiro em reais.
const numberToReal = numero => {

    var numero = numero.toFixed(2).split('.');
    numero[0] = "R$ " + numero[0].split(/(?=(?:...)*$)/).join('.');
    return numero.join(',');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8qIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgU0NSSVBUIC0gUHJvdmEgVMOpY25pY2EgfCBBZHJpYW5vIEdhbGxcclxuIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyovXHJcblxyXG5cclxuLy9CdXNjYSBvcyBwYXLDom1ldHJvcyBkYSB1cmwgcGFyYSBleGVjdXRhciBhbGlzdGFnZW0gZGUgcHJvZHV0b3NcclxuY29uc3QgZ2V0UGFyYW1ldGVyVXJsID0gKCkgPT4ge1xyXG4gICAgXHJcbiAgICBsZXQgcXVlcnkgPSBsb2NhdGlvbi5zZWFyY2guc2xpY2UoMSksXHJcbiAgICAgICAgcGFydGVzID0gcXVlcnkuc3BsaXQoJyYnKSxcclxuICAgICAgICBkYXRhID0ge307XHJcblxyXG4gICAgcGFydGVzLmZvckVhY2gocGFydGUgPT4ge1xyXG4gICAgICAgIGlmKHBhcnRlICE9ICcnKXtcclxuICAgICAgICAgICAgbGV0IGNoYXZlVmFsb3IgPSBwYXJ0ZS5zcGxpdCgnPScpIFxyXG4gICAgICAgICAgICAgICAgY2hhdmUgPSBjaGF2ZVZhbG9yWzBdLFxyXG4gICAgICAgICAgICAgICAgdmFsb3IgPSBjaGF2ZVZhbG9yWzFdO1xyXG4gICAgICAgICAgICBkYXRhW2NoYXZlXSA9IHZhbG9yO1xyXG4gICAgICAgIH0gICAgICAgICAgICBcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbi8vVmFyacOhdmVpcyBpbmljaWFpc1xyXG5sZXQgbnVtUGFnZSA9IDEsXHJcbiAgICBxbnRQYWdlID0gMjAsXHJcbiAgICBYbWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXHJcbiAgICBhcnFKc29uUHJvZCA9IFwiLi4vLi4vcHJvamVjdC9maWxlcy9tb2NrLXByb2R1Y3RzLmpzb25cIixcclxuICAgIGdldFBhcmFtVXJsID0gZ2V0UGFyYW1ldGVyVXJsKCksXHJcbiAgICBmaWx0ZXIgPSBcInZhbG9yLWRlc2NcIixcclxuICAgIHVybEluaXRpYWwgPSB0cnVlO1xyXG4gICAgXHJcbi8vVmVyaWZpY2EgZGUgdGVtIHBhcsOibWV0cm9zIGRlIGZpbHRyb3MgcGFzc2Fkb3MgbmEgdXJsIG5vIGNhcnJlZ2FtZW50byBkYSBww6FnaW5hXHJcbmlmKGdldFBhcmFtVXJsLmhhc093blByb3BlcnR5KCdxJykpeyAgXHJcblxyXG4gICAgdXJsSW5pdGlhbCA9IGZhbHNlO1xyXG4gICAgZmlsdGVyID0gZ2V0UGFyYW1VcmwucTtcclxuICAgIHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNoYW5nZS1maWx0ZXJcIikudmFsdWUgPSBmaWx0ZXI7XHJcbiAgICBcclxuICAgIGlmKGdldFBhcmFtVXJsLmhhc093blByb3BlcnR5KCdwYWdlJykpXHJcbiAgICAgICAgbnVtUGFnZSA9IGdldFBhcmFtVXJsLnBhZ2U7XHJcbn0gXHJcblxyXG4vL0Z1bsOnw6NvIHN0YXJ0IHBhcmEgYXMgZnVuY2luYWxpZGFkZXMgZGUgZmlsdHJvIGUgcGFnaW5hw6fDo29cclxuY29uc3QgZ2V0U3RhcnRMaXN0UHJvZCA9IChmaWx0ZXIsIG51bVBhZ2UpID0+IHtcclxuXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJnLWxvYWRlclwiKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpeyBcclxuICAgICAgICBvYmpKc29uUHJvZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdvYmpKc29uUHJvZCcpO1xyXG4gICAgb2JqSnNvblByb2QgPSBKU09OLnBhcnNlKG9iakpzb25Qcm9kKS5wcm9kdWN0cztcclxuICAgIG9yZGVyRmlsdGVySnNvbihvYmpKc29uUHJvZCwgZmlsdGVyLCBudW1QYWdlKTtcclxuICAgIHNldFVybEZpbHRlcihmaWx0ZXIsIG51bVBhZ2UpOyAgICBcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmctbG9hZGVyXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgXHJcbiAgICB9LCAxMDAwKTtcclxuICAgIFxyXG59XHJcblxyXG5jb25zdCByZXF1ZXN0ID0gb2JqID0+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHhoci5vcGVuKG9iai5tZXRob2QgfHwgXCJHRVRcIiwgb2JqLnVybCk7XHJcbiAgICAgICAgaWYgKG9iai5oZWFkZXJzKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9iai5oZWFkZXJzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIG9iai5oZWFkZXJzW2tleV0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdCh4aHIuc3RhdHVzVGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHhoci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KHhoci5zdGF0dXNUZXh0KTtcclxuICAgICAgICB4aHIuc2VuZChvYmouYm9keSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5yZXF1ZXN0KHt1cmw6IGFycUpzb25Qcm9kLCBtZXRob2Q6ICdHRVQnfSlcclxuICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwib2JqSnNvblByb2RcIiwgZGF0YSk7XHJcbiAgICAgICAgZ2V0U3RhcnRMaXN0UHJvZChmaWx0ZXIsIG51bVBhZ2UpOyAgXHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbn0pO1xyXG4gXHJcbi8vQXR1YWxpemEgb3MgcGFyw6JtZXRyb3MgbmEgdXJsXHJcbmNvbnN0IHNldFVybEZpbHRlciA9IChmaWx0ZXIsIG51bVBhZ2UpID0+IFxyXG4gICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKCcnLCAnJywgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVswXSArIFwiP3E9XCIgKyBmaWx0ZXIgKyBcIiZwYWdlPVwiICsgbnVtUGFnZSk7XHJcblxyXG4vL0NvbnRydXRvciBkYSBsaXN0YWdlbSBkZSBwcm9kdXRvc1xyXG5jb25zdCBjb25zdExpc3RQcm9kdWN0cyA9IChhcnJQcm9kLCBudW1QYWdlKSA9PiB7XHJcblxyXG4gICAgdmFyIGh0bWxMaXN0UHJvZCA9IFwiXCIsXHJcbiAgICAgICAgdGFyZ2V0UHJvZCA9IHBhcnNlSW50KG51bVBhZ2UtMSkgKiBwYXJzZUludChxbnRQYWdlKSxcclxuICAgICAgICBpMiA9IDA7XHJcblxyXG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGFyclByb2QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZih0YXJnZXRQcm9kIDw9IGkgJiYgaTIgPCBxbnRQYWdlKXtcclxuICAgICAgICAgICAgaHRtbExpc3RQcm9kICs9IGA8bGk+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9XCJsaW5rXCIgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKVwiIHRpdGxlPVwiYCArIGFyclByb2RbaV0ubmFtZSArIGBcIiBjbGFzcz1cImAgKyBhcnJQcm9kW2ldLm5hbWUrYFwiPjwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRodW1iXCI+PGltZyBhbHQ9XCJgICsgYXJyUHJvZFtpXS5uYW1lICsgYFwiIHRpdGxlPVwiYCArIGFyclByb2RbaV0ubmFtZSArIGBcIiBzcmM9XCJgICsgYXJyUHJvZFtpXS5pbWFnZSArIGBcIj48L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRlc2NcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMz5gICsgYXJyUHJvZFtpXS5uYW1lICsgYDwvaDM+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD4gPHNwYW4+UiQgYCArIG51bWJlclRvUmVhbChhcnJQcm9kW2ldLnByaWNlKTsgKyBgPC9zcGFuPjwvcD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPmA7XHJcbiAgICAgICAgICAgIGkyKys7XHJcbiAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICB9XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxpc3QtcHJvZHVjdHNcIikuaW5uZXJIVE1MID0gaHRtbExpc3RQcm9kO1xyXG59XHJcblxyXG4vL0NvbnRydXRvciBkYSBwYWdpbmHDp8Ojb1xyXG5jb25zdCBjb25zdFBhZ2luYXRvciA9IChvYmpMaXN0LCBmaWx0ZXIsIG51bVBhZ2UpID0+IHtcclxuXHJcbiAgICBsZXQgcW50VG90YWwgPSBPYmplY3Qua2V5cyhvYmpMaXN0KS5sZW5ndGgsXHJcbiAgICAgICAgaHRtbExpc3RQYWcgPSBcIlwiLFxyXG4gICAgICAgIGNvbnRyUGFnID0gcGFyc2VJbnQocW50VG90YWwtMSkgLyBwYXJzZUludChxbnRQYWdlKTtcclxuICAgICAgICBcclxuICAgIGZvcihsZXQgaSA9IDE7IGkgPD0gTWF0aC5jZWlsKGNvbnRyUGFnKTsgaSsrKSB7XHJcbiAgICAgICAgaWYobnVtUGFnZSA9PSBpKVxyXG4gICAgICAgICAgICBodG1sTGlzdFBhZyArPSBgPGxpIGNsYXNzPVwiYWN0aXZlXCI+PHNwYW4+YCArIGkgKyBgPC9zcGFuPjwvbGk+YDtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIGh0bWxMaXN0UGFnICs9IGA8bGk+PGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKVwiIG9uQ2xpY2s9XCJnZXRTdGFydExpc3RQcm9kKCdgICsgZmlsdGVyICsgYCcsYCArIGkgKyBgKTtcIj5gICsgaSArIGA8L2E+PC9saT5gOyAgICAgICAgICAgICBcclxuICAgIH1cclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFnLXByb2QtbmF2XCIpLmlubmVySFRNTCA9IGh0bWxMaXN0UGFnO1xyXG59XHJcblxyXG4vL09yZGVuYSBvIGFiamV0byBkZSBwcm9kdXRvcyBkZSBhY29yZG8gY29tIG8gZmlsdHJvXHJcbmNvbnN0IG9yZGVyRmlsdGVySnNvbiA9IChvYmpMaXN0LCBmaWx0ZXIsIG51bVBhZ2UpID0+IHsgXHJcblxyXG4gICAgbGV0IGFyckZpbHRlciA9IGZpbHRlci5zcGxpdCgnLScpO1xyXG4gICAgb2JqTGlzdC5zb3J0KGR5bmFtaWNTb3J0KGFyckZpbHRlcikpOyAgIFxyXG4gICAgbGV0IGFyclByb2QgPSBPYmplY3QudmFsdWVzKG9iakxpc3QpO1xyXG4gICAgXHJcbiAgICAvL0NvbnN0cnV0b3IgZGEgbGlzdGFnZW0gZGUgcHJvZHV0b3NcclxuICAgIGNvbnN0TGlzdFByb2R1Y3RzKGFyclByb2QsIG51bVBhZ2UpO1xyXG4gICAgXHJcbiAgICAvL0NvbnN0cnV0b3IgZGEgcGFnaW5hw6fDo29cclxuICAgIGNvbnN0UGFnaW5hdG9yKG9iakxpc3QsIGZpbHRlciwgbnVtUGFnZSk7XHJcbiAgICBcclxuICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MCk7XHJcbn1cclxuXHJcbi8vT3JkZW5hIG8gb2JqZWN0IGRlIHByb2R1dG9zIGNvbmZvcm1lIG9zIHBhcsOibWV0cm9zIHBhc3NhZG9zXHJcbmNvbnN0IGR5bmFtaWNTb3J0ID0gYXJydEZpbHRlciA9PiB7XHJcblxyXG4gICAgbGV0IHNvcnRPcmRlciA9IDEsXHJcbiAgICAgICAgcmVzdWx0O1xyXG5cclxuICAgIGlmKGFycnRGaWx0ZXJbMF0gPT09IFwiLVwiKSB7XHJcbiAgICAgICAgc29ydE9yZGVyID0gLTE7XHJcbiAgICAgICAgYXJydEZpbHRlciA9IGFycnRGaWx0ZXIuc3Vic3RyKDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAoYSxiKSA9PiB7XHJcbiAgICAgICAgaWYoYXJydEZpbHRlclsxXSA9PSAnYXNjJylcclxuICAgICAgICAgICAgcmVzdWx0ID0gKGFbYXJydEZpbHRlclswXV0gPCBiW2FycnRGaWx0ZXJbMF1dKSA/IC0xIDogKGFbYXJydEZpbHRlclswXV0gPiBiW2FycnRGaWx0ZXJbMF1dKSA/IDEgOiAwO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcmVzdWx0ID0gKGFbYXJydEZpbHRlclswXV0gPiBiW2FycnRGaWx0ZXJbMF1dKSA/IC0xIDogKGFbYXJydEZpbHRlclswXV0gPCBiW2FycnRGaWx0ZXJbMF1dKSA/IDEgOiAwO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQgKiBzb3J0T3JkZXI7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vVHJhdGEgbyB2YWxvciBpbnRlaXJvIGVtIHJlYWlzLlxyXG5jb25zdCBudW1iZXJUb1JlYWwgPSBudW1lcm8gPT4ge1xyXG5cclxuICAgIHZhciBudW1lcm8gPSBudW1lcm8udG9GaXhlZCgyKS5zcGxpdCgnLicpO1xyXG4gICAgbnVtZXJvWzBdID0gXCJSJCBcIiArIG51bWVyb1swXS5zcGxpdCgvKD89KD86Li4uKSokKS8pLmpvaW4oJy4nKTtcclxuICAgIHJldHVybiBudW1lcm8uam9pbignLCcpO1xyXG59XHJcbiJdfQ==
